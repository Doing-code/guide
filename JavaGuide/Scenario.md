# 场景

## 接口防抖

什么是防抖

1. 控制用户频繁点击同一个操作

2. 防止网络抖动

3. 避免接口请求频繁过载

哪一类接口需要防抖

1. 用户输入类接口

2. 按钮点击类接口

3. 滚动加载类接口

大致思路

**防抖**即重复提交，接口参数在短时间内一致。

`Redis key = sessionId + 请求路径 + IP`，设置过期时间。

`AOP + 注解 + Redis`防重复提交

## 电商场景

1. 瞬时流量，**高并发问题**

   高并发系统有以下三个经典的解决方案：

    - **缓存**

        - 使用 Redis 实现分布式缓存，另外配合 Nginx 缓存 + 本地 Caffeine 缓存 + CDN 缓存 + 浏览器缓存共同实现多级缓存来保证系统的性能

    - **限流**：Sentinel

    - **熔断**：Sentinel

2. **库存问题**，超卖和少卖问题

    - 超卖问题：**卖出商品的数量**大于**商品可卖库存**

      - 1.限流
      
      - 2.分布式锁（如商品信息 + 剩余库存作为 key）
      
      - 3.Redis Lua（先判断库存 -> 减库存 + 加订单）
       
      - 4.使用数据库 update 操作库存

    - 少卖问题：通常是指库存数量与实际销售量不匹配的情况，具体表现为库存系统显示有货，但实际发货时发现缺货，导致无法满足订单需求。
   
      - 通常使用及时对账系统 + 人工补偿机制来解决 

3. **弱网环境下支付问题**

   - 支付平台提供回调方法进行支付状态的刷新

4. **脚本刷单问题**

   - 1.支付平台提供回调方法进行支付状态的刷新

   - 2.添加异常观测平台和 IP 黑名单限制

5. **重复订单去重问题**

   - 通过幂等性判断去除重复订单（Redis 实现幂等）

   - 数据库唯一约束保底






























